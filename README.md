# GeoDMP

## 基本情報
### 機能一覧
| 記号 | 入力 |出力|備考|
| ------ | ------ |------ |------ |
| lti | 緯度経度 |  推定年収 |ログインが必要 |
| ltr | 緯度経度 |  相続税路線価 |ログインが必要| 

### RESTから呼び出す際の引数
* 下記の表の通り。〇：必要

| 引数名 | 説明 |  緯度経度→推定年収(lti)| 緯度経度→相続税路線価(ltr)|
| ------ | ------ |------ |------ |
| -i  | apiのid |〇|〇|
| -p  | apiのパスワード |〇|〇|
| -m  | モード(横軸参照) |〇|〇|
| -lat | 緯度 |〇|〇|
| -lon | 経度 |〇|〇|
| -r | 半径(m)　|〇|〇|


### 結果
#### 形式
* json
#### 見方
* `lat``lon``radius` : 入力値。それぞれ緯度、経度、半径
* `pref_code`:都道府県判定の結果の都道府県番号。以下の値をとる。
```
11:埼玉県, 12: 千葉県, 13:東京都, 14:神奈川県, 99:上記以外
```
* `status`:世帯データ取得状況。以下の値をとる。
```
success:世帯取得成功, out of area : 世帯取得失敗(上記pref_code99に対応), no households : 世帯取得失敗(pref_codeは99でないが、指定した位置・半径には世帯がない)
```
* `salary_mean`:平均年収(万円)。
* `rail_line_assessment`:相続税路線価(千円/㎡)

## 実行手順

* サーバーが起動していることを確認する。
* 管理者からidとパスワードを受け取る。
* 以下の例にそってsample_codes/latlon_restapi.pyを実行する。

```
#latlon→年収
(your_env)~/work/ecjointtest/api$ python3 latlon_restapi.py -i yourid -p yourpw -m lti -lat 35.643469 -lon 139.655432 -r 50

#latlon→路線価
(your_env)~/work/ecjointtest/api$ python3 latlon_restapi.py -i yourid -p yourpw -m ltr -lat 35.643469 -lon 139.655432 -r 50
```
## 注意
* 結果はjsonでかえってくるので、適宜値を取得してdfなどに格納すること
* 連続で取得する場合は、sleep文を入れること。

## FAQ
### 取得スピードが遅い。
* あまりにも時間が掛かりそうな場合は管理者まで相談すること。
### 取得結果にnanが多い。
* 以下の原因が考えられる。2番目については、適宜パラメータを調節すること。
```
* 住所が南関東の範囲外。status : out of area
* 指定した半径が小さすぎて世帯データを取得できていない。status : ho households
```
### json自体が返ってこない。
* 以下の原因が考えられる。
```
* ログインid,パスワードが間違っている。
* 指定した半径が大きすぎる。
```
* 上記以外の場合は管理者まで相談すること。

### その他
* 管理者まで相談すること。

## データソース
* マイクロベース株式会社「世帯単位属性推定データ」(2015年版) 

## バージョン情報
* 1.0.0 : 2020/03/04 南関東(埼玉県・千葉県・東京都・神奈川県)に対応
* 1.0.1 : 2020/03/09 高速化に対応